<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ì‚¬ë¼ì§„ ê³ ì–‘ì´ë¥¼ ì°¾ì•„ë¼</title>
    <link rel="stylesheet" href="../../css/common.css" />
    <link rel="icon" type="image/png" sizes="180x180" href="/favicon.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/favicon.png">
    <style>
        main {
            flex: 1;
            padding: 0rem;
            padding-bottom: 0rem;
            width: 100%;
            line-height: 0;
        }

        body {
            background: #1e1e1e;
            color: #eee;
            font-family: 'Courier New', monospace;
            padding: 0px;
        }

        #output {
            min-height: 324px;
            max-height: 324px;
            white-space: pre-wrap;
            line-height: 2.0;
            border: 1px solid #444;
            padding: 10px;
            margin-bottom: 10px;
            margin: 10px;
            background: #2a2a2a;
            overflow-y: auto;

        }

        button {
            background-color: #444;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 10px;
            font-size: 16px;
            cursor: pointer;
        }

        button:hover:not(:disabled) {
            background-color: #666;
        }

        button:disabled {
            background-color: #666;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .success {
            color: #0f0;
        }

        .failure {
            color: #f00;
        }

        .info {
            color: rgb(238, 255, 0);
        }

        #progress {
            margin-top: 20px;
            margin-left: 20px;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .progress-bar {
            width: 97%;
            margin-left: 10px;
            background: #444;
            height: 10px;
        }

        .progress-fill {
            height: 100%;
            background: rgb(68, 148, 240);
            width: 0%;
        }

        #prologue {
            animation: fadeIn 1s;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @media (max-width: 600px) {
            button {
                padding: 8px 16px;
                font-size: 14px;
            }

            #output {
                font-size: 14px;
            }
        }
    </style>
</head>

<body>
    <header>
        <div class="container">
            <h1>ê³ ì–‘ì´ë¥¼ ì°¾ì•„ë¼</h1>
            <a href="../../index.html" class="back-btn">ë’¤ë¡œ</a>
        </div>
    </header>
    <main>
        <div id="prologue">
            <div id="output"></div>
            <button onclick="startGame()">ì‹œì‘</button>
        </div>
        <div id="game" style="display: none;">
            <div id="progress">í¬íš: 0/3</div>
            <div class="progress-bar">
                <div class="progress-fill"></div>
            </div>
            <div id="output"></div>
            <button onclick="searchCat()">íƒìƒ‰</button>
            <button onclick="useItem()" id="itemBtn">ì¸„ë¥´ ì‚¬ìš© (1ê°œ ë‚¨ìŒ)</button>
            <button onclick="showCaught()">í¬íš ë¦¬ìŠ¤íŠ¸</button>
            <button onclick="showGuide()">ê³ ì–‘ì´ ë„ê°</button>
        </div>
        <audio id="bgm" loop></audio>
    </main>
    <footer>
        <div class="container">
            í•œ ê±¸ìŒì”©, ê¿ˆì„ í–¥í•´ ğŸŒŸ
        </div>
    </footer>
    <script>
        const cats = [
            { name: "ì¶˜ì‹ì´", age: 2, speed: "ëŠë¦¼", baseCatchRate: 0.7, isCaught: false },
            { name: "ì¶˜ë°°", age: 3, speed: "ë³´í†µ", baseCatchRate: 0.5, isCaught: false },
            { name: "ë‚˜ë¹„", age: 1, speed: "ë¹ ë¦„", baseCatchRate: 0.3, isCaught: false }
        ];

        let itemCount = 1;
        let currentCat = null;
        let output = document.getElementById("output");
        let startTime = null;
        let turnCount = 0;

        const maxTurns = 100;
        const bgmFiles = ["bgm1.mp3", "bgm2.mp3"];

        function log(text, type = "") {
            const classMap = { success: "success", failure: "failure", info: "info" };
            output.innerHTML += `<span class="${classMap[type] || ''}">${text}</span>\n`;
            output.scrollTop = output.scrollHeight;
        }

        function playSound(type) {
            if (type === "meow") {
                // Placholder for meow sound; replace with actual file path
                new Audio("meow.mp3").play().catch(() => { });
            }
            // Other sounds (success, failure, click) commented out until files are available
            const sounds = {
                success: "success.mp3",
                failure: "failure.mp3",
                click: "click.mp3"
            };
            if (sounds[type]) {
                new Audio(sounds[type]).play().catch(() => { });
            }
        }

        function updateProgress() {
            const caught = cats.filter(c => c.isCaught).length;
            document.getElementById("progress").textContent = `í¬íš: ${caught}/3`;
            document.querySelector(".progress-fill").style.width = `${(caught / 3) * 100}%`;
        }

        function disableAllButtons() {
            document.querySelectorAll("#game button").forEach(btn => btn.disabled = true);
        }

        function checkGameEnd() {
            if (cats.every(c => c.isCaught)) {
                const seconds = Math.floor((Date.now() - startTime) / 1000);
                const minutes = Math.floor(seconds / 60);
                const hours = Math.floor(minutes / 60);

                showCaught();
                disableAllButtons();

                log(`âœ¨ì„±ê³µâœ¨ ëª¨ë“  ê³ ì–‘ì´ë¥¼ ì°¾ì•˜ì–´ìš”!\ní”Œë ˆì´ ì‹œê°„: ${hours}ì‹œê°„ ${minutes % 60}ë¶„ ${seconds % 60}ì´ˆ\n`, "success");

                return true;
            }
            if (turnCount >= maxTurns) {
                const seconds = Math.floor((Date.now() - startTime) / 1000);
                const minutes = Math.floor(seconds / 60);
                const hours = Math.floor(minutes / 60);
                showCaught();
                disableAllButtons();
                log(`ì‹¤íŒ¨.. ë…¸ë ¥í•´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.\ní”Œë ˆì´ ì‹œê°„: ${hours}ì‹œê°„ ${minutes % 60}ë¶„ ${seconds % 60}ì´ˆ\n`, "failure");
                return true;
            }
            return false;
        }

        function startGame() {
            playSound("click");
            document.getElementById("prologue").style.display = "none";
            document.getElementById("game").style.display = "block";
            output = document.querySelector("#game #output"); // Reassign output to game output
            output.innerHTML = "";
            startTime = Date.now();
            const bgm = document.getElementById("bgm");
            bgm.src = bgmFiles[Math.floor(Math.random() * bgmFiles.length)];
            bgm.play().catch(() => log("ìŒì•… ì¬ìƒì„ ìœ„í•´ í•œ ë²ˆ ë” í´ë¦­í•´ì£¼ì„¸ìš”!", "info"));
            log("ê²Œì„ì„ ì‹œì‘í•˜ë ¤ë©´ [íƒìƒ‰] ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”.", "info");
            updateProgress();
        }

        function searchCat() {
            playSound("click");
            turnCount++;
            if (checkGameEnd()) return;
            const chance = Math.random();
            if (chance < 0.6) {
                currentCat = cats[Math.floor(Math.random() * cats.length)];
                if (currentCat.isCaught) {
                    log(`\nìµìˆ™í•œ ê³ ì–‘ì´ ${currentCat.name}ê°€ ë‹¤ì‹œ ë‚˜íƒ€ë‚¬ì§€ë§Œ ì´ë¯¸ ë‹¹ì‹ ê³¼ ì¹œêµ¬ì˜ˆìš”.`, "info");
                    currentCat = null;
                    return;
                }
                playSound("meow");
                log(`\nì–´ë‘  ì†ì—ì„œ ë¬´ì–¸ê°€ê°€ ë‚˜íƒ€ë‚¬ì–´ìš”...\n${currentCat.name} (ë‚˜ì´: ${currentCat.age}, ì†ë„: ${currentCat.speed})`, "success");
                
                if (itemCount > 0) {
                    log(`\n[ì¸„ë¥´ ì‚¬ìš©]ìœ¼ë¡œ í¬íš ì‹œë„ ê°€ëŠ¥`, "");
                } else {
                    log(`\n[ì¸„ë¥´]ê°€ ì—†ì–´ í¬íš ë¶ˆê°€ëŠ¥`, "failure");
                }
            } else {
                const isGetItem = Math.random() < 0.24 && itemCount < 2;
                if (isGetItem) {
                    itemCount++;
                    log("\nìµìˆ™í•œ ì¸„ë¥´ê°€ ë³´ì¸ë‹¤!\nì¸„ë¥´ 1ê°œ íšë“!", "");
                    document.getElementById("itemBtn").innerText = `ì¸„ë¥´ ì‚¬ìš© (${itemCount}ê°œ ë‚¨ìŒ)`;
                    document.getElementById("itemBtn").disabled = false;
                } else {
                    log("\nì£¼ìœ„ë¥¼ ì‚´í´ë³´ì•˜ì§€ë§Œ ì•„ë¬´ ê³ ì–‘ì´ë„ ë³´ì´ì§€ ì•Šì•„ìš”...", "failure");
                }
                currentCat = null;
            }
        }

        function useItem() {
            playSound("click");
            if (!currentCat) {
                log("\nê³ ì–‘ì´ê°€ ì—†ì–´ìš”! ë¨¼ì € íƒìƒ‰ì„ í•´ì£¼ì„¸ìš”.", "failure");
                return;
            }
            if (itemCount <= 0) {
                log("\nì¸„ë¥´ê°€ ì—†ì–´ìš”!", "failure");
                return;
            }
            const successChance = currentCat.baseCatchRate + 0.5;
            const result = Math.random() < successChance;
            if (result) {
                currentCat.isCaught = true;
                playSound("success");
                log(`\nì„±ê³µ! ${currentCat.name}ê°€ ë‹¹ì‹ ì—ê²Œ ë‹¤ê°€ì™€ ì¹œêµ¬ê°€ ë˜ì—ˆì–´ìš”! ğŸ‰`, "success");
            } else {
                playSound("failure");
                log(`\n${currentCat.name}ê°€ ì¸„ë¥´ë¥¼ ë³´ê³ ë„ ë„ë§ì³¤ì–´ìš”... ğŸ¾`, "failure");
            }
            itemCount--;
            document.getElementById("itemBtn").innerText = `ì¸„ë¥´ ì‚¬ìš© (${itemCount}ê°œ ë‚¨ìŒ)`;
            document.getElementById("itemBtn").disabled = itemCount <= 0;
            currentCat = null;
            updateProgress();
            checkGameEnd();
        }

        function showCaught() {
            playSound("click");
            const caught = cats.filter(c => c.isCaught);
            if (caught.length === 0) {
                log("\nì•„ì§ í¬íší•œ ê³ ì–‘ì´ê°€ ì—†ì–´ìš”...", "info");
            } else {
                let msg = "\nğŸ“œ í¬íší•œ ê³ ì–‘ì´ ëª©ë¡:\n";
                caught.forEach(c => {
                    msg += `- ${c.name} (ë‚˜ì´: ${c.age}, ì†ë„: ${c.speed})\n`;
                });
                log(msg, "info");
            }
        }

        function showGuide() {
            playSound("click");
            let msg = "ğŸ“– ê³ ì–‘ì´ ë„ê°:\n";
            cats.forEach((cat, i) => {
                msg += `${i + 1}. ${cat.name}\n`;
                msg += `í¬íš: ${cat.isCaught ? "O" : "X"}\n`;
                if (cat.isCaught) {
                    msg += `ë‚˜ì´: ${cat.age}\nì†ë„: ${cat.speed}\n`;
                }
                msg += "\n";
            });
            log(msg, "info");
        }
        // Initialize prologue output
        output.innerHTML = `\n3ë§ˆë¦¬ ê³ ì–‘ì´ê°€ ì‚¬ë¼ì¡Œì–´ìš”!\nì°¾ì•„ì£¼ì„¸ìš”!\n\nğŸ“œ ê²Œì„ ì„¤ëª…: \n1.íƒìƒ‰ ë²„íŠ¼ìœ¼ë¡œ ê³ ì–‘ì´ë¥¼ ì°¾ì•„ë³´ì„¸ìš”.\n2.ì¸„ë¥´(1ê°œ)ë¥¼ ì‚¬ìš©í•˜ë©´ í¬íš í™•ë¥ ì´ ë†’ì•„ì§‘ë‹ˆë‹¤.\n3.ëª¨ë“  ê³ ì–‘ì´ë¥¼ í¬íší•˜ë©´ ìŠ¹ë¦¬!\n`;
    </script>
</body>

</html>